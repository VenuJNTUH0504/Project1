<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Execution - CodePathway</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #1abc9c;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --border-color: #ddd;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--secondary-color);
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-link {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link:hover {
            color: var(--secondary-color);
        }

        .code-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .code-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .section-header {
            padding: 1rem 1.5rem;
            background-color: var(--light-color);
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            color: var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--secondary-color);
        }

        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: white;
            font-size: 1rem;
        }

        .code-editor {
            width: 100%;
            height: 300px;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .execute-btn {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .execute-btn:hover {
            background-color: #2980b9;
        }

        .result-container {
            margin-top: 2rem;
        }

        .result-header {
            padding: 0.75rem;
            border-radius: 4px 4px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .result-header.success {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .result-header.error {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .result-output {
            padding: 1rem;
            background-color: var(--light-color);
            border-radius: 0 0 4px 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .loading {
            padding: 1rem;
            text-align: center;
            color: var(--secondary-color);
        }

        .language-info {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--light-color);
            border-radius: 4px;
        }

        .language-info h3 {
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
        }

        .language-info p {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .language-info code {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .nav-links {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Code Execution</h1>
            <div class="nav-links">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="user-profile.html" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="logout" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <div class="code-container">
            <div class="code-section">
                <div class="section-header">
                    <span>Code Editor</span>
                </div>
                <div class="section-body">
                    <form id="code-execution-form">
                        <div class="form-group">
                            <label for="code-language">Select Language</label>
                            <select id="code-language" name="language" required>
                                <option value="" disabled selected>Choose a language</option>
                                <option value="python">Python</option>
                                <option value="javascript">JavaScript</option>
                                <option value="java">Java</option>
                                <option value="cpp">C++</option>
                                <option value="golang">Go</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="code-editor">Write Your Code</label>
                            <textarea id="code-editor" class="code-editor" name="code" placeholder="Enter your code here..." required></textarea>
                        </div>
                        <button type="submit" class="execute-btn">
                            <i class="fas fa-play"></i> Execute Code
                        </button>
                    </form>

                    <div id="language-info" class="language-info" style="display: none;">
                        <!-- Language-specific info will be shown here -->
                    </div>

                    <div id="execution-result" class="result-container">
                        <!-- Execution results will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is authenticated
            fetch('/api/auth/check')
                .then(response => response.json())
                .then(data => {
                    if (!data.authenticated) {
                        // Redirect to login if not authenticated
                        window.location.href = '/login.html';
                    }
                })
                .catch(error => {
                    console.error('Authentication check error:', error);
                    window.location.href = '/login.html';
                });
            
            const languageSelect = document.getElementById('code-language');
            const codeEditor = document.getElementById('code-editor');
            const languageInfo = document.getElementById('language-info');
            const codeForm = document.getElementById('code-execution-form');
            const resultContainer = document.getElementById('execution-result');
            
            // Language examples and info
            const languageData = {
                python: {
                    title: 'Python',
                    description: 'Python is a high-level, interpreted programming language known for its readability and simplicity.',
                    example: 'print("Hello, World!")\n\n# Calculate the sum of numbers from 1 to 10\nsum = 0\nfor i in range(1, 11):\n    sum += i\nprint(f"Sum: {sum}")'
                },
                javascript: {
                    title: 'JavaScript',
                    description: 'JavaScript is a versatile scripting language primarily used for web development.',
                    example: 'console.log("Hello, World!");\n\n// Calculate the sum of numbers from 1 to 10\nlet sum = 0;\nfor (let i = 1; i <= 10; i++) {\n    sum += i;\n}\nconsole.log(`Sum: ${sum}`);'
                },
                java: {
                    title: 'Java',
                    description: 'Java is a class-based, object-oriented programming language designed for portability and cross-platform development.',
                    example: 'public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, World!");\n        \n        // Calculate the sum of numbers from 1 to 10\n        int sum = 0;\n        for (int i = 1; i <= 10; i++) {\n            sum += i;\n        }\n        System.out.println("Sum: " + sum);\n    }\n}'
                },
                cpp: {
                    title: 'C++',
                    description: 'C++ is a general-purpose programming language created as an extension of the C programming language.',
                    example: '#include <iostream>\n\nint main() {\n    std::cout << "Hello, World!" << std::endl;\n    \n    // Calculate the sum of numbers from 1 to 10\n    int sum = 0;\n    for (int i = 1; i <= 10; i++) {\n        sum += i;\n    }\n    std::cout << "Sum: " << sum << std::endl;\n    \n    return 0;\n}'
                },
                golang: {
                    title: 'Go',
                    description: 'Go (or Golang) is a statically typed, compiled language designed at Google for simplicity and efficiency.',
                    example: 'package main\n\nimport "fmt"\n\nfunc main() {\n    fmt.Println("Hello, World!")\n    \n    // Calculate the sum of numbers from 1 to 10\n    sum := 0\n    for i := 1; i <= 10; i++ {\n        sum += i\n    }\n    fmt.Printf("Sum: %d\\n", sum)\n}'
                }
            };
            
            // Show language info and example when language is selected
            languageSelect.addEventListener('change', function() {
                const selectedLanguage = this.value;
                
                if (selectedLanguage && languageData[selectedLanguage]) {
                    const data = languageData[selectedLanguage];
                    
                    languageInfo.innerHTML = `
                        <h3>${data.title} Example</h3>
                        <p>${data.description}</p>
                        <p>Try this example:</p>
                        <pre><code>${data.example}</code></pre>
                    `;
                    
                    languageInfo.style.display = 'block';
                    
                    // Set example code if editor is empty
                    if (!codeEditor.value.trim()) {
                        codeEditor.value = data.example;
                    }
                } else {
                    languageInfo.style.display = 'none';
                }
            });
            
            // Handle form submission
            codeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const language = languageSelect.value;
                const code = codeEditor.value;
                
                if (!language || !code) {
                    alert('Please select a language and enter code');
                    return;
                }
                
                // Show loading state
                resultContainer.innerHTML = '<div class="loading">Executing code...</div>';
                
                // Execute code
                fetch('/api/execute-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        language: language,
                        code: code
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Code execution failed');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // Display result
                    const statusClass = data.status === 'success' ? 'success' : 'error';
                    
                    resultContainer.innerHTML = `
                        <div class="result-header ${statusClass}">
                            <span>${data.status === 'success' ? 'Success' : 'Error'}</span>
                            <span>Execution Time: ${data.executionTime.toFixed(2)}s</span>
                        </div>
                        <pre class="result-output">${data.result || 'No output'}</pre>
                    `;
                })
                .catch(error => {
                    console.error('Code execution error:', error);
                    resultContainer.innerHTML = `
                        <div class="result-header error">
                            <span>Error</span>
                        </div>
                        <pre class="result-output">${error.message}</pre>
                    `;
                });
            });
        });
    </script>
</body>
</html>